#!/bin/ksh

APPLDIR=@prefix@
LIBDIR=${APPLDIR}/lib/python2.5/site-packages
# Set some basic environment:
. ${HOME}/.profile_msg_oper

userid=`whoami`

# $1: N-slots back in time from now

if test -f ${MSG_PP_OPER_MODE_FILE}; then
    . ${APPLDIR}/etc/.profile_msgpp
else
    echo "host `uname -n` is not the current operational node..."
    echo "...don't run NWCSAF/MSG smhi post-processing."
    exit
fi

# ---> msg_remap_all_Oper.py:
# Check that no session is already active 
psres1=`ps -edalf | grep "msg_remap_all_Oper.py" | grep -v grep`
ok1=1
if [ -n "$psres" ]; then 
    psres_user=`echo "$psres" | grep "$userid"`
    echo "msg_remap_all_Oper.py active from somewhere..." >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_remap_all_Oper.log 2>&1
    echo "$psres" >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_remap_all_Oper.log 2>&1
    if [ -n "$psres_user" ]; then
	echo "***msg_remap_all_Oper already active, abort****" >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_remap_all_Oper.log 2>&1 
	ok1=0
    fi
fi
if [ "$ok1" ]; then
    python ${LIBDIR}/msg_remap_all_Oper.py 1 >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_remap_all_Oper.log 2>&1
fi
# ---------------------------

# ---> msg_rgb_remap_all_Oper.py:
# Check that no session is already active 
psres=`ps -edalf | grep "msg_rgb_remap_all_Oper.py" | grep -v grep`
ok2=1
if [ -n "$psres" ]; then 
    psres_user=`echo "$psres" | grep "$userid"`
    echo "msg_rgb_remap_all_Oper.py active from somewhere..." >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_rgb_remap_all_Oper.log
    if [ -n "$psres_user" ]; then
	echo "***msg_rgb_remap_all_Oper already active, abort****" >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_rgb_remap_all_Oper.log 2>&1
	ok2=0
    fi
fi
if [ "$ok2" ]; then
    python ${LIBDIR}/msg_rgb_remap_all_Oper.py 1 >> /local_disk/opt/NWCSAF_MSG_PP/current/log/msg_rgb_remap_all_Oper.log 2>&1
fi
# ---------------------------

