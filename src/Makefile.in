include @top_srcdir@/def.mk

#HLHDF_INCLUDE_DIR = /local_disk/usr/src/hlhdf-v0.7.7/hlhdf
#HLHDF_LIB_DIR = /local_disk/usr/src/hlhdf-v0.7.7/hlhdf

NWCLIB_INC_DIR = @MSG_INSTALL_ROOT@/include/NWCLIB
NWCLIB_LIB_DIR = @MSG_INSTALL_ROOT@/bin

NUMPY_INC_DIR = /usr/lib64/python2.4/site-packages/numpy/core/include

top_srcdir = @top_srcdir@
INSTALL_DIR = @prefix@
BIN_DIR = $(INSTALL_DIR)/bin
INC_DIR = $(INSTALL_DIR)/include
LIB_DIR = $(INSTALL_DIR)/lib
PY_LIB_DIR = $(INSTALL_DIR)/lib/python2.5/site-packages


CFLAGS = -Wall -g3 -I/usr/include -I$(HLHDF_INCLUDE_DIR) -I$(NWCLIB_INC_DIR) $(INCLUDE_PYTHON) -I$(NUMPY_INC_DIR)
LFLAGS = -L/usr/lib64 -L$(HLHDF_LIB_DIR) -L$(NWCLIB_LIB_DIR)
LIBS = -Xlinker -Bstatic -lnwclib -lmsg -Xlinker -Bdynamic -lhlhdf -lm -lhdf5


MOD_SOURCES = py_msgmodule.c
MOD_OBJECTS = $(MOD_SOURCES:.c=.o)
MOD_TARGET = py_msgmodule.so

LIB_SOURCES = libmsg_channel.c
LIB_OBJECTS = $(LIB_SOURCES:.c=.o)
LIB_HEADER = libmsg_channel.h
LIB_TARGET = libmsg_channel.so 


INSTALL = $(top_srcdir)/install-sh
CC=gcc

all: $(MOD_TARGET)

$(MOD_TARGET):  $(MOD_OBJECTS) $(LIB_TARGET) 
	$(CC) -shared $< -o $@ $(LFLAGS) -L. $(LIBS) -lmsg_channel 

%.so: %.o
	$(CC) -shared $< -o $@ $(LFLAGS) $(LIBS) 

.c.o: 
	$(CC) -fPIC -c -Wall $< -o $@ $(CFLAGS)

clean:
	rm -f *~ *.o *.so

distclean: clean
	rm Makefile

install: all
	$(top_srcdir)/mkinstalldirs $(BIN_DIR)
	$(top_srcdir)/mkinstalldirs $(LIB_DIR)
	$(top_srcdir)/mkinstalldirs $(PY_LIB_DIR)
	$(top_srcdir)/mkinstalldirs $(INC_DIR)
	$(INSTALL) $(MOD_TARGET) $(PY_LIB_DIR)/
	$(INSTALL) $(LIB_TARGET) $(LIB_DIR)/
	$(INSTALL) $(LIB_HEADER) $(INC_DIR)/

uninstall:
	rm $(PY_LIB_DIR)/$(MOD_TARGET)
	rm $(LIB_DIR)/$(LIB_TARGET)
	rm $(INC_DIR)/$(LIB_HEADER)